/*! bmoor 2013-09-28 */
!function(a,b,c){"use strict";function d(a){console&&console.log&&(console.log(a),console.trace())}function e(){}function f(){this.args=arguments}function g(){}var h=document.getElementsByTagName("script"),i=h[h.length-1],j={},k={templator:["bmoor","templating","JQote"],templatorTag:"#",jsRoot:i.hasAttribute("root")?i.getAttribute("root"):i.getAttribute("src").match(/^(.*)\/b[Mm]oor(\.min)?\.js/)[1]};String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var l={parse:function(a){return a?"string"==typeof a?a.split("."):a.length?a.slice(0):a:[]},get:function(a,c){var d,e,f=b;if(a&&("string"==typeof a||a.length)){a=this.parse(a),c&&(d=a.length-1,e=a[d],a[d]=e.charAt(0).toLowerCase()+e.slice(1));for(var g=0;g<a.length;g++){var h=a[g];f[h]||(f[h]={}),f=f[h]}}return f},exists:function(a,c){var d,e,f=b;if(a){if("string"==typeof a||a.length){a=this.parse(a),c&&(d=a.length-1,e=a[d],a[d]=e.charAt(0).toLowerCase()+e.slice(1));for(var g=0;g<a.length;g++){var h=a[g];if(!f[h])return null;f=f[h]}return f}return a}return null}},m={requests:0,onReady:[]};!function(){var a={},b={};m.parseResource=function(a){var b=a.match(/^(.*)\/(js|src)/);return b?b[1]:a.match(/^[js|src]/)?null:null},m.reset=function(){b={".":{fullName:!1},">":this.parseResource(k.jsRoot),"/":k.jsRoot,jquery:{"/":k.jsRoot+"/jquery",".":{fullName:!0}}}},m.reset(),m.setRoot=function(a){b["/"]=a,b[">"]=this.parseResource(a)},m.setLibrary=function(a,d,e,f){var g=b,h=l.parse(a);for(e||(e={});h.length;){var i=h.shift();g[i]===c&&(g[i]={}),g=g[i]}g["/"]=d,g["."]=e,g["*"]=f===!0,g[">"]=this.parseResource(d)},m.delLibrary=function(a){for(var c=b,d=null,e=null,f=l.parse(a);f.length&&c;){var g=f.shift();c[g]?(d=c,e=g,c=c[e]):c=null}c&&delete d[e]},m.getLibrary=function(a,c){for(var d=b,e=b,f=l.parse(a),g=c?null:f.pop(),h=f.slice(0);f.length;){var i=f[0];if(!d[i])break;d=d[f.shift()],d["/"]&&(e=d,h=f.slice(0))}return e["*"]?{root:e["/"],path:[],name:g,settings:e["."],resource:e[">"]}:{root:e["/"],path:h,name:g,settings:e["."],resource:e[">"]}},m.loadSpace=function(b,f,g,h,i){function j(){i===c&&(i={}),h===c&&(h=[]),g.apply(i,h)}function k(a){var c=l.exists(b);!c||c instanceof e||c.prototype&&c.prototype.__defining?setTimeout(k,10):g?(clearTimeout(a),j()):clearTimeout(a)}var m;if(b=l.parse(b),"function"==typeof f?(i=h,h=g,g=f,f=b):f||(f=b),m=l.exists(b))m instanceof e?k():j();else{var n=this.getLibrary(f),o=n.root+(n.path.length?"/"+n.path.join("/"):"")+"/"+(n.settings.fullName?f.join("."):n.name),p=function(c){var e,f,g,h=a[o];for(e=setTimeout(function(){l.exists(b)||d("loaded file : "+c+"\n but no class : "+b.join("."))},5e3),f=0,g=h.length;g>f;f++)h[f](e);a[o]=!0};a[o]?a[o].push(k):"boolean"==typeof a[o]?k():(a[o]=[k],bMoor.module.Resource.loadScriptSet(o+".js",o+".min.js",p))}},m.done=function(a){0===this.requests?a():this.onReady.push(a)},m.require=function(a,b,c){function d(){var a,c,d,e,f=[];if(m--,0===m){for(k.requests--,m--,c=0,a=p,d=a?a.length:0;d>c;c++)f.push(l.get(a[c]));if(b.apply({},f),0===k.requests){for(;k.onReady.length;)e=k.onReady.shift(),e();k.onReady=[]}}}var e,f,g,h,i,j,k=this,m=1,n=null,o=null,p=null;for(a.substring?(o=p=[a],n={}):a.length?(o=p=a,n={}):(n=a.references?a.references:{},o=a.classes?a.classes:[],p=a.aliases?a.aliases:[]),this.requests++,i=0,h=o,j=h?h.length:0;j>i;i++)f=l.parse(h[i]),m++,this.loadSpace(f,d);for(g in n)f=l.parse(g),m++,this.loadSpace(f,n[g],d);if(a.scripts&&(m++,bMoor.module.Resource.loadScript(a.scripts,d,c?c+"/js/":"js/")),a.styles)for(g in a.styles)m++,e=a.styles[g],"/"!=e.charAt(0)&&(e=c?c+"/css/"+e:"css/"+e),bMoor.module.Resource.loadStyle(e,d);if(a.templates)for(g in a.templates)m++,e=a.templates[g],"/"!=e.charAt(0)&&(e=c?c+"/template/"+e:"template/"+e),bMoor.module.Resource.loadScript(e,d);d()}}(),function(){function c(a,b,c){var d=typeof c,e=b[a];"function"==d?b[a]=function(){var a,b=this._wrapped;return this._wrapped=e,a=c.apply(this,arguments),this._wrapped=b,a}:"string"==d&&(b[a]+=" "+c)}function d(a,c,d){var e=c.parent?l.get(c.parent):null,f=c.namespace?l.parse(c.namespace):[],g=c.namespace?l.get(f):b;if(e&&(e.prototype.__name||(e.prototype.__name=c.parent),a.extend(d,e),e.prototype.__onDefine))if(c.onDefine){var h=c.onDefine;c.onDefine=function(a,b,c,d){e.prototype.__onDefine.call(this,a,b,c,d),h.call(this,a,b,c,d)}}else c.onDefine=e.prototype.__onDefine;d.prototype.__construct=c.construct?c.construct:e?e.prototype.__construct:function(){},d.prototype.__defining=!0,g[c.name]=d,f.push(c.name),d.prototype.__class=f.join("."),d.prototype.__name=f.pop(),c.onDefine&&(d.prototype.__onDefine=c.onDefine),c.aliases&&a.alias(d,c.aliases),a.statics(d,c.statics),c.properties&&a.properties(d,c.properties)}var h=[],i=!1,k=0;g.prototype.define=function(c){function g(){var e,f=l.exists(c.parent);if(f&&f.prototype.__defining)setTimeout(g,10);else if(d(j,c,q),c.onDefine&&(e=c.onDefine.apply(q.prototype,[c,p,c.name,q])),e||(e=p[c.name]),c.onReady&&a(document).ready(function(){m.done(function(){c.onReady(e)})}),delete q.prototype.__defining,k--,0===k)for(;h.length;){var i=h.pop();i(a,b)}}var j=this,n=c.require,o=m.getLibrary(c.namespace,!0).resource,p=l.get(l.parse(c.namespace)),q=function(){i||this.__construct.apply(this,arguments[0]instanceof f?arguments[0].args:arguments)};if(k++,!c.name)throw"Need name for class";p[c.name]=new e,n?n.length&&(n={classes:n}):n={},c.parent&&(n.classes?n.classes.push(c.parent):n.classes=[c.parent]),c.aliases&&(n.aliases=c.aliases),m.require(n,g,o)},g.prototype.singleton=function(a){var b=a.onDefine?a.onDefine:function(){};a.onDefine=function(a,c,d,e){var f,g=new e,h=d.charAt(0).toLowerCase()+d.slice(1);return c[h]=g,b.apply(this,[a,c,d,e,g]),a.module&&(f=a.module,f=f.charAt(0).toUpperCase()+f.slice(1).toLowerCase(),j[f]=g),g},this.define(a)},g.prototype.factory=function(a){var b=a.onDefine?a.onDefine:function(){};a.onDefine=function(a,c,d,e){var f={},g=function(){return Array.prototype.push.call(arguments,e),a.factory.apply(f,arguments)};c[d.charAt(0).toLowerCase()+d.slice(1)]=g,b.apply(this,arguments)},this.define(a)},g.prototype.decorator=function(a){var b,d;a.properties||(a.properties={}),b=a.properties._decorate,d=a.construct,delete a.properties._decorate,delete a.construct,a.properties._decorate=function(a,e){var f;d&&(e?c("__construct",a,function(){this._wrapped&&this._wrapped.apply(this,arguments),d.apply(this,arguments)}):d.apply(a));for(f in this)"__construct"!==f&&"_decorate"!==f&&(a[f]?c(f,a,this[f]):a[f]=this[f]);return b&&b.call(a),a},this.singleton(a)},g.prototype.mutate=function(a,b){var c,d,e=a.onDefine?a.onDefine:function(){};if(a.decorators){for(d="string"==typeof a.decorators?d.split(","):a.decorators,a.require?a.require.length&&(a.require={classes:a.require}):a.require={},a.require.classes||(a.require.classes=[]),c=0;c<d.length;c++)a.require.classes.push(d[c]);a.onDefine=function(a,b,c,f){var g,h,i;for(e.apply(this,[a,b,c,f]),g=0,i=d,h=i.length;h>g;g++)l.get(i[g],!0)._decorate(this,!0);for(g in a.noOverride)this[g]=a.noOverride[g]}}b?this.singleton(a):this.define(a)},g.prototype.properties=function(a,b){for(var c in b)a.prototype[c]=b[c]},g.prototype.statics=function(b,c){b.prototype.__static?(b.prototype.__static={},a.extend(b.prototype.__static,c)):b.prototype.__static=c?c:{}},g.prototype.alias=function(a,b){for(var c in b){var d=b[c];a.prototype["__"+d]=l.get(c).prototype}},g.prototype.extend=function(a,b){i=!0,a.prototype=new b,a.prototype.constructor=a,a.prototype[b.prototype.__class]=b.prototype,i=!1},g.prototype.loaded=function(c){k?h.push(c):c(a,b)}}(),b.bMoor={module:j,setTemplate:function(a,b){this.templates[a]=b},templates:{},require:function(){m.require.apply(m,arguments)},get:function(a,b){return l.exists(a,b)},settings:k,autoload:m,constructor:new g},function(){var b={};bMoor.constructor.singleton({name:"Resource",namespace:["bmoor","lib"],module:"Resource",onReady:function(a){var b,c=document.getElementsByTagName("script");bMoor.setTemplate=function(b,c){a.setTemplate(b,c)};for(b in bMoor.templates)a.setTemplate(b,bMoor.templates[b]);for(var d=0,e=c.length;e>d;d++){var f=c[d];f.id&&(f.src&&(a.__static.loadedScripts[f.src]=f.id),"text/html"==f.getAttribute("type")&&a.setTemplate(f.id,f.innerHTML))}},statics:{loadedScripts:{}},properties:{loadScriptSet:function(){var b=Array.prototype.slice.call(arguments,0),c=b.pop(),e=b.shift(),f=e,g=function(){a.getScript(e).done(c).fail(function(a,c,h){b.length?(e=b.shift(),g()):d("failed to load file : "+f+"\nError : "+h)})};g()},loadScript:function(b,c,e){var f,g=this;"string"==typeof b&&(b=[b]),f=(e||"")+b.shift(),a.getScript(f).done(function(){b.length?g.loadScript(b,c,e):c()}).fail(function(a,b,c){d("failed to load file : "+f+"\nError : "+c)})},loadStyle:function(b,c){var d,e,f,g=null;e=document.createElement("link"),e.setAttribute("href",b),e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.sheet?(f="sheet",d="cssRules",g=setInterval(function(){try{e[f]&&e[f][d]&&e[f][d].length&&(clearInterval(g),c())}catch(a){}},10)):a(e).bind("load",c),a("head").append(e)},loadImage:function(b,c){var d=new Image;"#"==b[0]&&(b=a(b)[0].src),d.onload=c,d.src=b},loadTemplate:function(d,e,f){var g,h=null,i=bMoor.templates;if(f===c&&"string"!=typeof e&&(f=e,e=null),"#"===d[0]&&(d=d.substring(1)),!i[d])if(b[e]){var j=loadedScript[e];i[j]?i[d]=i[j]:this.setTemplate(d,document.getElementById(j).innerHTML)}else if((g=document.getElementById(d))!==c)this.setTemplate(d,g.innerHTML);else{if(null===e)throw"loadTemplate : "+d+" requested, and not found, while src is null";h=this,a.ajax(e,{success:function(a){h.setTemplate(a),f(i[d])}})}if(null===h){if(!f)return i[d];f(i[d])}return null},setTemplate:function(a,b){var c=bMoor.templates;switch(typeof b){case"string":c[a]=b.replace(/\s*<!\[CDATA\[\s*|\s*\]\]>\s*|[\r\n\t]/g,"");break;case"function":c[a]=b.toString().split(/\n/).slice(1,-1).join("\n")}}}},!0)}()}(jQuery,this),function(){bMoor.constructor.singleton({name:"Bouncer",namespace:["bmoor","lib"],module:"Schedule",construct:function(){this._stack=[],this._done=[],this._pauseAfter=null,this._lock=!1},properties:{runPause:30,runWindow:300,_setTime:function(){this._pauseAfter=(new Date).getTime()+this.runWindow},add:function(a){this._stack.push(a)},done:function(a){this._done.push(a)},_run:function(){if(this._lock=!1,this._stack.length)this.run();else if(this._done.length){for(;this._done.length;)this.add(this._done.shift());this.run()}else this._pauseAfter=null},run:function(){var a,b=this;this._stack.length&&!this._lock?(this._lock=!0,a=this._stack.shift(),0===this.runWindow?(a(),this._run()):(null===this._pauseAfter&&this._setTime(),a(),(new Date).getTime()>this._pauseAfter?setTimeout(function(){b._pauseAfter=null,b._run()},this.runPause):this._run())):this._run()}}})}(jQuery,this),function(){bMoor.constructor.singleton({name:"MouseTracker",namespace:["bmoor","lib"],onReady:function(a){$(document.body).on("mousemove",function(b){a.x=b.pageX,a.y=b.pageY})}})}(this),function(){bMoor.constructor.singleton({name:"WaitFor",namespace:["bmoor","lib"],construct:function(){},require:{references:{"bMoor.module.Resource":["bmoor","lib","Resource"]}},module:"Wait",properties:{_waiting:0,_done:[],_return:function(){var a;for(this._waiting--;this._done.length&&this._waiting<1;)a=this._done.pop(),a()},done:function(a){this._waiting<1?a():this._done.unshift(a)},require:function(a,b){var c=this;return this._waiting++,bMoor.autoload.require(a,function(){b&&b(),c._return()}),this},loadScript:function(a,b){var c=this;return this._waiting++,bMoor.module.Resource.loadScript(a,function(){b&&b(),c._return()}),this},loadStyle:function(a,b){var c=this;return this.waiting++,bMoor.module.Resource.loadStyle(a,function(){b&&b(),c._return()}),this},loadImage:function(a,b){var c=this;return this._waiting++,bMoor.module.Resource.loadImage(a,function(){b&&b(),c._return()}),this},loadTemplate:function(a,b,c){var d=this;return this._waiting++,bMoor.module.Resource.loadTemplate(a,b,function(){c&&c(),d._return()}),this}}})}(jQuery,this);